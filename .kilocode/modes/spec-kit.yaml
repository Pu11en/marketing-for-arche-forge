name: "spec-kit"
description: "Comprehensive spec-driven development workflow that orchestrates the complete development process from specification to implementation"
entrypoint: ".kilocode/workflows/spec-kit.md"
version: "1.0.0"
author: "Kilo Code"
license: "MIT"

# Dependencies required for this mode to function
dependencies:
  - "temp-spec-kit"
  - ".kilocode/workflows/*"
  - ".kilocode/scripts/*"

# Supported commands and their mappings
commands:
  # Main unified workflow command
  - name: "spec-kit"
    description: "Start or continue the unified spec-driven development workflow"
    workflow: ".kilocode/workflows/spec-kit.md"
    aliases: ["spk", "specify"]
    
  # Individual phase commands (for direct access)
  - name: "spec-kit.specify"
    description: "Create or update feature specification"
    workflow: ".kilocode/workflows/speckit.specify.md"
    aliases: ["spk.specify", "specify"]
    
  - name: "spec-kit.clarify"
    description: "Resolve ambiguities in specification"
    workflow: ".kilocode/workflows/speckit.clarify.md"
    aliases: ["spk.clarify", "clarify"]
    
  - name: "spec-kit.plan"
    description: "Create implementation plan"
    workflow: ".kilocode/workflows/speckit.plan.md"
    aliases: ["spk.plan", "plan"]
    
  - name: "spec-kit.tasks"
    description: "Generate task breakdown"
    workflow: ".kilocode/workflows/speckit.tasks.md"
    aliases: ["spk.tasks", "tasks"]
    
  - name: "spec-kit.analyze"
    description: "Analyze implementation readiness"
    workflow: ".kilocode/workflows/speckit.analyze.md"
    aliases: ["spk.analyze", "analyze"]
    
  - name: "spec-kit.implement"
    description: "Execute implementation tasks"
    workflow: ".kilocode/workflows/speckit.implement.md"
    aliases: ["spk.implement", "implement"]
    
  # Utility commands
  - name: "spec-kit.status"
    description: "Show current workflow progress"
    script: ".kilocode/scripts/workflow-manager.ps1 -Status"
    aliases: ["spk.status", "status"]
    
  - name: "spec-kit.report"
    description: "Generate progress report"
    script: ".kilocode/scripts/reporter.ps1"
    aliases: ["spk.report", "report"]
    
  - name: "spec-kit.validate"
    description: "Validate current phase or artifact"
    script: ".kilocode/scripts/validator.ps1"
    aliases: ["spk.validate", "validate"]

# Workflow configuration
workflow:
  # Sequential phases that must be completed in order
  phases:
    - name: "specify"
      description: "Transform user idea into structured specification"
      required: true
      validation:
        - "no_implementation_details"
        - "measurable_success_criteria"
        - "complete_user_stories"
        - "max_3_ambiguities"
        
    - name: "clarify"
      description: "Resolve ambiguities and refine requirements"
      required: true
      depends_on: ["specify"]
      validation:
        - "max_3_ambiguities_remaining"
        - "all_critical_questions_answered"
        
    - name: "plan"
      description: "Create technical implementation plan"
      required: true
      depends_on: ["clarify"]
      validation:
        - "constitution_compliance"
        - "technical_decisions_documented"
        - "research_complete"
        
    - name: "tasks"
      description: "Break down implementation into executable tasks"
      required: true
      depends_on: ["plan"]
      validation:
        - "user_story_coverage_complete"
        - "dependency_graph_valid"
        - "mvp_tasks_identified"
        
    - name: "analyze"
      description: "Quality analysis and validation"
      required: true
      depends_on: ["tasks"]
      validation:
        - "no_critical_issues"
        - "coverage_adequate"
        - "security_reviewed"
        
    - name: "implement"
      description: "Execute the implementation plan"
      required: true
      depends_on: ["analyze"]
      validation:
        - "tests_pass"
        - "specification_met"
        - "quality_checks_passed"

# State management
state:
  file: ".specify/workflow-state.json"
  format: "json"
  backup: true
  retention_days: 30

# Quality gates
quality_gates:
  specify:
    - name: "no_implementation_details"
      description: "Specification must not contain implementation details"
      validator: ".kilocode/scripts/validator.ps1 -Phase specify"
      
    - name: "measurable_success_criteria"
      description: "Success criteria must be measurable and technology-agnostic"
      validator: ".kilocode/scripts/validator.ps1 -Phase specify"
      
    - name: "complete_user_stories"
      description: "All user stories must be complete with acceptance criteria"
      validator: ".kilocode/scripts/validator.ps1 -Phase specify"
      
    - name: "max_3_ambiguities"
      description: "Maximum 3 clarification markers allowed"
      validator: ".kilocode/scripts/validator.ps1 -Phase specify"
      
  clarify:
    - name: "max_3_ambiguities_remaining"
      description: "Maximum 3 ambiguities may remain after clarification"
      validator: ".kilocode/scripts/validator.ps1 -Phase clarify"
      
    - name: "all_critical_questions_answered"
      description: "All critical questions must be answered"
      validator: ".kilocode/scripts/validator.ps1 -Phase clarify"
      
  plan:
    - name: "constitution_compliance"
      description: "Plan must comply with project constitution"
      validator: ".kilocode/scripts/validator.ps1 -Phase plan"
      
    - name: "technical_decisions_documented"
      description: "All technical decisions must be documented"
      validator: ".kilocode/scripts/validator.ps1 -Phase plan"
      
    - name: "research_complete"
      description: "All research items must be resolved"
      validator: ".kilocode/scripts/validator.ps1 -Phase plan"
      
  tasks:
    - name: "user_story_coverage_complete"
      description: "All user stories must have corresponding tasks"
      validator: ".kilocode/scripts/validator.ps1 -Phase tasks"
      
    - name: "dependency_graph_valid"
      description: "Task dependencies must be valid"
      validator: ".kilocode/scripts/validator.ps1 -Phase tasks"
      
    - name: "mvp_tasks_identified"
      description: "MVP tasks must be clearly identified"
      validator: ".kilocode/scripts/validator.ps1 -Phase tasks"
      
  analyze:
    - name: "no_critical_issues"
      description: "No critical issues should be found"
      validator: ".kilocode/scripts/validator.ps1 -Phase analyze"
      
    - name: "coverage_adequate"
      description: "Test coverage must be adequate"
      validator: ".kilocode/scripts/validator.ps1 -Phase analyze"
      
    - name: "security_reviewed"
      description: "Security considerations must be reviewed"
      validator: ".kilocode/scripts/validator.ps1 -Phase analyze"
      
  implement:
    - name: "tests_pass"
      description: "All tests must pass"
      validator: ".kilocode/scripts/validator.ps1 -Phase implement"
      
    - name: "specification_met"
      description: "Implementation must meet specification"
      validator: ".kilocode/scripts/validator.ps1 -Phase implement"
      
    - name: "quality_checks_passed"
      description: "All quality checks must pass"
      validator: ".kilocode/scripts/validator.ps1 -Phase implement"

# Error handling and recovery
error_handling:
  # Recovery strategies for different error types
  recovery_strategies:
    - error_type: "missing_prerequisites"
      strategy: "provide_guidance"
      message: "Missing required artifacts for phase. Run previous phases first."
      
    - error_type: "quality_gate_failure"
      strategy: "offer_options"
      message: "Quality gate validation failed. Options: fix issues, override with justification, or return to previous phase."
      
    - error_type: "constitution_violation"
      strategy: "require_justification"
      message: "Constitution violation detected. Explicit justification required."
      
    - error_type: "script_execution_failure"
      strategy: "retry_with_fallback"
      message: "Script execution failed. Retrying with fallback options."
      
  # Rollback points for recovery
  rollback_points:
    - phase: "specify"
      checkpoint: "spec_created"
      artifacts: ["specs/{feature}/spec.md"]
      command: "git checkout HEAD~1 -- specs/{feature}/spec.md"
      
    - phase: "plan"
      checkpoint: "plan_validated"
      artifacts: ["specs/{feature}/plan.md"]
      command: "git checkout HEAD~1 -- specs/{feature}/plan.md"
      
    - phase: "tasks"
      checkpoint: "tasks_generated"
      artifacts: ["specs/{feature}/tasks.md"]
      command: "git checkout HEAD~1 -- specs/{feature}/tasks.md"

# Integration settings
integration:
  # Template locations
  templates:
    spec: "temp-spec-kit/templates/spec-template.md"
    plan: "temp-spec-kit/templates/plan-template.md"
    tasks: "temp-spec-kit/templates/tasks-template.md"
    checklist: "temp-spec-kit/templates/checklist-template.md"
    
  # Script locations
  scripts:
    create_feature: "temp-spec-kit/scripts/powershell/create-new-feature.ps1"
    check_prerequisites: "temp-spec-kit/scripts/powershell/check-prerequisites.ps1"
    setup_plan: "temp-spec-kit/scripts/powershell/setup-plan.ps1"
    update_context: "temp-spec-kit/scripts/powershell/update-agent-context.ps1"
    
  # Output directories
  output:
    specs: "specs"
    checklists: "specs/{feature}/checklists"
    contracts: "specs/{feature}/contracts"

# User experience settings
user_experience:
  # Progress visualization
  progress_visualization:
    enabled: true
    format: "text"  # Options: text, markdown, html, json
    
  # Contextual help
  contextual_help:
    enabled: true
    level: "progressive"  # Options: minimal, progressive, detailed
    
  # Interactive guidance
  interactive_guidance:
    enabled: true
    confirmation_required: true
    auto_advance: false

# Compatibility settings
compatibility:
  # Backward compatibility with individual commands
  backward_compatibility:
    enabled: true
    individual_commands_accessible: true
    
  # Forward compatibility for future extensions
  forward_compatibility:
    plugin_system: true
    custom_phases: true
    extensible_validation: true

# Metadata
metadata:
  created: "2024-01-15"
  updated: "2024-01-15"
  category: "development_workflow"
  tags: ["spec-driven", "workflow", "development", "quality", "automation"]
  documentation: "spec-kit-integration-design.md"
  examples:
    - "Start new feature: /spec-kit 'Add user authentication'"
    - "Continue workflow: /spec-kit continue"
    - "Check status: /spec-kit.status"
    - "Generate report: /spec-kit.report -Markdown"